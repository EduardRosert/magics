#!/usr/bin/ksh

home=".."
version="2.21.1"
install_home="../../$version"

debug="off"
bufr="on"
netcdf="on"
odb="off"
grib="on"
metview="off"
cairo="on"
spot="off"
regression="off"
static_lib="off"

cmake="/usr/local/apps/cmake/current/bin/cmake"
boost="/usr/local/apps/boost/1.50.0"

proj4="/usr/local/apps/proj4/4.8.0/LP64"
python="/usr/local/apps/python/2.7.1-02"
netcdf_lib="/usr/local/apps/netcdf4/4.1.3/LP64"
odb_lib="/usr/local/apps/odb_api/0.9.31"
grib_lib="/usr/local/lib/metaps/lib/grib_api/1.11.0"
pgi_lib="/usr/local/apps/pgi/pgi-10.8/linux86-64/10.8/libso"
spot_lib="/usr/local/lib/metaps/lib/spot_database/new"
emos_lib="/usr/local/apps/libemos/000393"

args="-DCMAKE_INSTALL_PREFIX=${install_home}"
args=" $args -DCMAKE_MODULE_PATH=${home}/cmake -DENABLE_STATIC_LIBRARY=ON"
args=" $args -DBOOST_ROOT=$boost"
args=" $args -DPROJ4_PATH=$proj4"
args=" $args -DCMAKE_PREFIX_PATH=$python"

if [[ $debug = "on" ]];then
    args="$args -DCMAKE_BUILD_TYPE=Debug"
    echo "Debug enabled"
else
    args="$args -DCMAKE_BUILD_TYPE=Production"
    echo "Release Mode enabled"
fi
if [[ $static_lib = "on" ]];then
    args="$args  -DENABLE_STATIC_LIBRARY=ON"
    echo "build static library"
else
    args="$args -DENABLE_STATIC_LIBRARY=OFF"
    echo "No Static Mode enabled"
fi
if [[ $regression = "on" ]];then
    args="$args -DENABLE_REGRESSION=ON -DENABLE_REGRESSION_UPLOAD=on"
    echo "Regression enabled"
else
    args="$args -DENABLE_REGRESSION=OFF"
    echo "Regression disabled"
fi
if [[ $metview = "on" ]];then
    args="$args -DENABLE_METVIEW=ON"
    echo "Metview enabled"
else
    args="$args -DENABLE_MEVIEW=OFF"
    echo "Metview not required"
fi
if [[ $cairo = "on" ]];then
    args="$args -DENABLE_CAIRO=ON"
    echo "Cairo enabled"
else
    args="$args -DENABLE_CAIRO=OFF"
    echo "Cairo not required"
fi
if [[ $bufr = "on" ]];then
    args=" $args -DENABLE_BUFR=ON"
    if [[ $pgi_lib != "" ]];then
        args=" $args -DWITH_PGI_FORTRAN=ON -DPGI_PATH=${pgi_lib}"
    fi 
    if [[ $emos_lib != "" ]];then
        args=" $args -DEMOS_PATH=${emos_lib}"
    fi
    echo "Bufr enabled"
else
    args="$args -DENABLE_BUFR=OFF"
    echo "Bufr not required"
fi
if [[ $netcdf = "on" ]];then
    args=" $args -DENABLE_NETCDF=ON "
    echo "Netcdf enabled"
    if [[ $netcdf_lib != "" ]];then
        args=" $args -DNETCDF_PATH=${netcdf_lib}"
    fi
else
    args="$args -DENABLE_NETCDF=OFF"
    echo "NETCDF not required"
fi
if [[ $odb = "on" ]];then
    args="$args -DENABLE_ODB=ON "
    echo "ODB enabled"
    if [[ $odb_lib != "" ]];then
        args=" $args -DODB_API_PATH=${odb_lib}"
    fi
else
    args="$args -DENABLE_ODB=OFF"
    echo "ODB not required"
fi
if [[ $grib = "on" ]];then
    args="$args -DENABLE_GRIB=ON "
    echo "GRIB enabled"
    if [[ $grib_lib != "" ]];then
        args=" $args -DGRIB_API_PATH=${grib_lib}"
    fi
else
    args="$args -DENABLE_GRIB=OFF"
    echo "GRIB not required"
fi
if [[ $spot = "on" ]];then
    args="$args -DENABLE_SPOT=ON "
    echo "SPOT enabled"
    if [[ $spot_lib != "" ]];then
        args=" $args -DSPOT_PATH=${spot_lib}"
    fi
else
    args="$args -DENABLE_SPOT=OFF"
    echo "SPOT not required"
fi
echo $args
$cmake ${home} $args
